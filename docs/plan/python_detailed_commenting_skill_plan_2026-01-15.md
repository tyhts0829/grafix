# 何を: 「XXX.py について、動作を理解したいから細かくコメント入れて」用の Codex Skill を作る

## ゴール

- 任意の `*.py` を指定すると、**挙動を変えずに**理解用のコメント（モジュール/関数/クラス/重要ブロック）を追加できる。
- コメントの粒度・書き方が一貫し、読む順番で理解が進む（上 → 下で OK）。
- Skill が `./.codex/skills`（リポジトリ配下）または `$CODEX_HOME/skills` に置かれ、再起動後に使える。

## 非ゴール（今回やらない）

- コメント以外の変更（リファクタ、命名、ロジック変更、最適化、バグ修正）。
- 依存追加、CI/設定の変更、テスト追加。

## 仕様案（ドラフト）

### 期待するアウトカム

1. 読む前提が揃う（このファイルの役割・責務・入力/出力・副作用が分かる）
2. 追える（主要データフロー/制御フローの「どこで何が起きるか」が追跡できる）
3. 迷子にならない（難所に「なぜそうするか」「何を前提にしているか」が書かれている）

### コメントの原則

- 「何をしているか」より「**なぜ**そうしているか / 何を前提にしているか」を優先して書く。
- “わからない” を放置しない: 不明点は推測を書き、**確認ポイント**（どこを見れば確定できるか）を残す。
- 既存スタイルに合わせる（既に docstring があるなら docstring を補強、無いなら最小限追加、など）。

### 変更ルール（安全柵）

- 変更は **コメント/Docstring のみ**（空白整形も最小限。意味のある整形が必要なら理由を書く）。
- 実行結果が変わり得る変更（順序、名前、式、import、型ヒント追加など）はしない。
- もしコメントだけでは説明不能なら、**コード変更せず**に「補助図解（文章）」を返信に添える。

### 生成するコメントの粒度（目安）

- モジュール先頭: 5〜15 行で「目的/入力/出力/副作用/主要依存」を要約
- 主要クラス/関数: docstring で「責務/引数/戻り値/例外/副作用/前提」を整理
- 難所: ブロック単位で 1〜3 行の要点 + 前提（invariant）+ 注意点

### トリガー例（ユーザーが言いそうな文）

- 「`foo.py` の動作が分かるように細かくコメント入れて」
- 「この Python ファイルを理解したいので、コード内に解説コメントを追加して」
- 「挙動は変えずに、読みやすいコメントを足して」

## 実装計画（チェックリスト）

### 1) 仕様確定（最小の確認）

- [ ] コメント言語はどうする？（候補: `日本語` / `英語` / `既存に合わせる`）；日本語
- [ ] 追記対象はどこまで？（候補: `inline + docstring` / `inline のみ` / `docstring のみ`）；両方
- [ ] 返信にも要約を出す？（候補: `出す` / `出さない（ファイル内コメントのみ）`）；出さない

### 2) Skill 名の決定

- [ ] 命名（lowercase + hyphen）。候補:
  - `python-detailed-commenting`
  - `python-add-explanatory-comments`
  - `py-comment-for-understanding`

### 3) Skill テンプレ生成

- [ ] `init_skill.py` で雛形作成（出力先は `./.codex/skills` か `$CODEX_HOME/skills`）
  - 例（リポ配下）: `python ~/.codex/skills/.system/skill-creator/scripts/init_skill.py python-detailed-commenting --path ./.codex/skills`
  - 例（ホーム配下）: `python ~/.codex/skills/.system/skill-creator/scripts/init_skill.py python-detailed-commenting --path ~/.codex/skills`
  - メモ: `~/.codex/skills` はこのリポ外なので、エージェントに作業させる場合は書き込み許可が必要
  - 原則: `SKILL.md` 以外は必要になった時だけ増やす（過剰にディレクトリを作らない）

### 4) `SKILL.md` 実装（中身）

- [ ] YAML frontmatter は `name` と `description` のみ（description にトリガー文言も含める）
- [ ] 本文は命令形で、次のワークフローを短く書く:
  1. 対象ファイルを特定（パスが無ければ聞く）
  2. まず全体像を把握（責務・入出力・副作用・依存）
  3. コメントを追加（モジュール要約 → API docstring → 難所コメント）
  4. “挙動変更なし” をセルフチェック（差分レビュー観点を列挙）
  5. 可能なら軽い検証（例: `python -m py_compile <file>`、テストがあるなら実行）
- [ ] 出力品質の Do/Don’t を 10 行程度で明文化（例: “何をしてるかの逐語説明は避ける”）

### 5) （必要なら）`references/` の追加

- [ ] `SKILL.md` が長くなる/例が増える場合だけ `references/` に分離
  - 例: `references/commenting_patterns.md`（コメントの型、テンプレ、良い/悪い例）

### 6) バリデーション & パッケージ

- [ ] 形式チェック: `python ~/.codex/skills/.system/skill-creator/scripts/quick_validate.py ~/.codex/skills/<skill-name>`
- [ ] 配布したい場合だけパッケージ化:
  - `python ~/.codex/skills/.system/skill-creator/scripts/package_skill.py ~/.codex/skills/<skill-name> ./dist`

### 7) 動作確認（実運用テスト）

- [ ] Codex を再起動して Skill が拾われることを確認
- [ ] 3 つの代表プロンプトで試す（短いファイル/長いファイル/副作用が多いファイル）
- [ ] 気になった点を `SKILL.md` に反映（トリガー文言、コメント粒度、禁止事項の明確化）

## Done の定義（DoD）

- 任意の `*.py` に対して、コメント追加後も挙動を変えずに理解しやすい状態になる。
- トリガー文言で Skill が安定して発火する（`description` を調整して達成）。

## 要確認（あなたに決めてもらいたいこと）

- Skill 名はどれにしますか？（上の候補 or 新案）
- コメント言語は `日本語` 固定で OK？（それとも “既存に合わせる” をデフォルトにする？）
- 「コメントのみ」厳守で OK？（補助として返信に短い図解/要約を付けても良い？）
