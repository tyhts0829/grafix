# どこで: `AGENTS.md`（ルート）。必要なら `src/grafix/AGENTS.md` や `docs/agent_docs/*` を新設。

# 何を: `blog.md` のベストプラクティス（WHY/WHAT/HOW、指示を減らす、段階的開示、ポインタ化、事実ベース、重要情報を冒頭へ）に合わせて、`AGENTS.md` を短く・読みやすく・遵守されやすい形に再設計する。

# なぜ: 指示が多い/長いほど無視されやすい前提で、毎回のセッション開始時に「迷子にならない地図」と「正否を判定できる検証方法」だけを最短距離で渡すため。

## ゴール

- ルート `AGENTS.md` は「毎回必要な普遍情報」だけに絞る（目安: 100 行以内、重要情報は冒頭 30 行以内）。
- WHY/WHAT/HOW が明確（目的・リポ構造・検証手段）。
- 詳細ルールは段階的開示（別ファイル or ネスト `AGENTS.md` に分離）し、ルートは参照ポイントだけを置く。
- 命令文を減らし、「このリポでは〜」の事実記述を基本にする。
- 既存の Safety 境界と、手元のワークフロー（`git status --porcelain` 等）は維持しつつ、重複を削る。

## 非ゴール（今回やらない）

- コード実装の変更。
- 新しい依存追加・CI 変更。
- 長文化を招く網羅的ドキュメント化（必要なら別途 docs に分離）。

## 現状の課題（`AGENTS.md`）

- WHY/WHAT/HOW のうち、WHAT/HOW はあるが、WHY（プロジェクト目的/設計意図/地図）が薄い。
- 「禁止/必須」系の命令が多く、情報密度は高いがノイズ化しやすい。
- Docstring/テスト指針など詳細が同居し、ルート `AGENTS.md` としては段階的開示が弱い。
- 重要度が異なる情報が同じ粒度で並ぶ（冒頭に“最重要だけ”が出ていない）。

## 目標アウトライン案（改訂後の `AGENTS.md`）

1. TL;DR（最重要 5 行程度）
   - このリポは何か（Grafix: creative coding + pen plotter）
   - 触る場所（`src/grafix/`）
   - まず回す検証コマンド（pytest/ruff/mypy）
   - Safety 境界（Ask-first の代表例）
2. WHY（目的 / 設計の核への導線）
   - `README.md` / `architecture.md` へのポインタ（コピペしない）
3. WHAT（リポ地図）
   - 主要ディレクトリの短表（1 行ずつ）
4. HOW（検証）
   - 最小のテスト/型/lint コマンド
5. Work rules（最小限）
   - `git status --porcelain` の扱い
   - 破壊的操作/依存追加の承認
6. 詳細ポリシーへの参照（段階的開示）
   - docstring ルール、テスト詳細、stubs 手順などは別ファイルへ

## チェックリスト（改善アクション）

- [ ] ① `blog.md` の原則を反映した「設計方針」を 5〜7 行で定義する
  - DoD: WHY/WHAT/HOW と “指示を減らす/段階的開示” が明文化される
- [ ] ② `AGENTS.md` 冒頭に TL;DR を追加し、重要情報を先頭へ移動する
  - DoD: 初見でも 30 秒で「何/どこ/どう検証」が分かる
- [ ] ③ WHY セクションを追加し、`README.md` と `architecture.md` への導線を置く（コピペしない）
  - DoD: 詳細説明は参照に逃がし、ルートを短く保つ
- [ ] ④ WHAT（リポ地図）を追加する: `src/grafix`, `tests`, `docs`, `sketch`, `tools`, `typings` を 1 行ずつ
  - DoD: “どこを見るべきか” が明確
- [ ] ⑤ HOW（検証）を整理する: `pytest`, `ruff`, `mypy` の推奨コマンドを最小セットに統合する
  - DoD: 重複がなく、1 回の変更で走らせる順が分かる
- [ ] ⑥ 命令文を削減し、事実ベースの記述へ寄せる（例: 「〜すること」→「このリポでは〜」）
  - DoD: 禁止/必須の数が目に見えて減り、読み飛ばしリスクが下がる
- [ ] ⑦ 段階的開示を導入する（どちらかを選ぶ）
  - [ ] A 案: `docs/agent_docs/` を新設し、詳細ルールを移動（ルートは参照のみ）；こちらで
  - [ ] B 案: `src/grafix/AGENTS.md` 等にネストして、スコープが狭いルールを移動
  - DoD: ルート `AGENTS.md` が短くなり、詳細は必要時だけ読める
- [ ] ⑧ “リンターをさせるな” を反映する: 手作業のスタイル指示を減らし、ツール結果に従う方針に寄せる
  - DoD: `ruff` を一次情報として扱う（スタイル説明の長文を持たない）
- [ ] ⑨ Safety/PR セクションの言い回しを整理する（重複削除、代表例だけに）
  - DoD: Ask-first の箇条書きが短くなる（ただし境界は維持）
- [ ] ⑩ 仕上げ: 行数/見出し/箇条書きの見やすさをチェックし、目標行数に収める
  - DoD: 目標（例: 100 行以内）を満たす。重要情報が冒頭にある。

## 要確認（あなたに決めてもらいたいこと）

- 段階的開示は A 案（`docs/agent_docs/`）と B 案（ネスト `AGENTS.md`）、どちらで進めますか？
- ルート `AGENTS.md` の目標行数はどのくらいにしますか？（例: 80/100/120）；80
- Docstring ルールは「ルートに最小だけ残す」か「全面的に別ファイルへ移す」か、どちらが好みですか？；

## 追加提案（後回しで OK）

- `AGENTS.md` の repo map を README と二重管理しない（AGENTS はポインタだけにする）。
- `AGENTS.md` に “更新運用” を 3〜5 行だけ書き、陳腐化を防ぐ（例: 主要コマンドが変わったら即更新）。
